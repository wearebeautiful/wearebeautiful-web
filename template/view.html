{%- extends 'base-view.html' -%}
{%- block content -%}
  <div class="row h-100">
    <div class="col-12">
       <canvas id="canvas" width="1400" height="1000"></canvas>
    </div>
    <div class="row" id="info-row">
        <div id="progress" class="col-6">
        </div>
        <div id="info" class="col-6 text-right">
           {% if model.body_part != "anatomical" %}
             {{ model.body_part }} of a {{ model.gender }} with a {{ model.body_type }} body. 
           {% else %}
              anatomical model
           {% endif %}
        </div>
    </div>
  </div>
{% endblock%}

{% block scripts %}
{{ bootstrap.load_js() }}
<script src="{{url_for('static', filename='js/')}}"></script>
<script type="module">

    import {Viewer} from "/static/js/node_modules/@xeokit/xeokit-sdk/src/viewer/Viewer.js";
    import {STLLoaderPlugin} from "/static/js/node_modules/@xeokit/xeokit-sdk/src/plugins/STLLoaderPlugin/STLLoaderPlugin.js";

    const viewer = new Viewer({
        canvasId: "canvas"
    });

    const stlLoader = new STLLoaderPlugin(viewer);

    const model = stlLoader.load({
        id: "{{ model }}",
        src: "{{ model_file }}",
        smoothNormals: true,
        backfaces : true
    });

    model.on("loaded", () => {
        $("#progress").text("{{ model.model_id }}-{{ model.code }}");
        model.highlight = [1,0,0];
        viewer.cameraFlight.jumpTo(model);
        viewer.scene.on("tick", () => {
            viewer.camera.orbitYaw(0.4);
        })
    });
</script>
{% endblock %}
